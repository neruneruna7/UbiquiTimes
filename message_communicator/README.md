かなりごちゃついてる
関数の切り分けとかひどい
なさなくちゃな